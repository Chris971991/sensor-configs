name: Hubitat Bundles

on:
  push:
    branches:
      - main
    paths:
      - 'integrations/hubitat/**'
  workflow_dispatch:

jobs:
  bundle:
    runs-on: ubuntu-latest
    name: Bundle
    steps:
      - uses: actions/checkout@v4

      - name: Build bpmk1 bundle
        run:  |
          mkdir bed-presence-mk1-bundle
          cp integrations/hubitat/bundles/bed-presence-mk1.txt bed-presence-mk1-bundle/install.txt
          cp integrations/hubitat/bundles/bed-presence-mk1.txt bed-presence-mk1-bundle/update.txt
          cp integrations/hubitat/drivers/bed-presence-mk1.groovy bed-presence-mk1-bundle/elevated_sensors.BedPresenceMk1.groovy
          wget -O bed-presence-mk1-bundle/esphome.espHomeApiHelper.groovy https://raw.githubusercontent.com/ElevatedSensors/hubitat-espHomeApiHelper/refs/heads/main/ESPHome/ESPHome-API-Library.groovy

      - name: Zip bpmk1
        uses: thedoctor0/zip-release@0
        with:
          type: 'zip'
          directory: bed-presence-mk1-bundle
          filename: bed-presence-mk1-hubitat-bundle.zip
